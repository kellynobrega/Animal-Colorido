<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8" />
  <title>Hora de Pintar</title>
  <style>
    body {
      margin: 0;
      font-family: "Comic Sans MS", cursive, sans-serif;
      background: #add8e6; /* azul bebê */
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }

    .container {
      display: flex;
      background: #e0f0ff; /* azul clarinho */
      border-radius: 20px;
      box-shadow: 0 6px 15px rgba(0, 0, 0, 0.15);
      overflow: hidden;
    }

    .sidebar {
      width: 100px;
      background: #cce6ff; /* azul clarinho */
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 10px;
    }

    .sidebar button,
    .tools button {
      background: none;
      border: none;
      margin: 10px 0;
      cursor: pointer;
      transition: transform 0.2s;
    }

    .sidebar button:hover,
    .tools button:hover {
      transform: scale(1.2);
    }

    .palette {
      width: 60px;
      height: 400px;
      overflow-y: auto;
      margin-top: 15px;
    }

    .color {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      margin: 5px auto;
      cursor: pointer;
      border: 2px solid #fff;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }

    .main {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 15px;
    }

    canvas {
      border: 3px solid #ccc;
      border-radius: 15px;
      background: white;
      cursor: crosshair;
    }

    .tools {
      margin-top: 15px;
      display: flex;
      gap: 10px;
    }

    .tools button {
      padding: 10px;
      border-radius: 10px;
      background: #cce6ff; /* azul clarinho */
      font-size: 14px;
    }
  </style>
</head>

<body>
  <div class="container">
    <!-- Barra lateral -->
    <div class="sidebar">
      <!-- Ferramentas -->
      <button onclick="setTool('bucket')">
        <img src="https://i.postimg.cc/3wsLL18m/pincel.png" width="120" />
      </button>

      <!-- Paleta de cores -->
      <div class="palette" id="palette"></div>
    </div>

    <!-- Área principal -->
    <div class="main">
      <canvas id="canvas" width="600" height="600"></canvas>

      <div class="tools">
        <button onclick="clearCanvas()">🧹 Limpar</button>
        <button onclick="saveImage()">💾 Salvar</button>
      </div>
    </div>
  </div>

  <!-- 🔊 Som de pintura -->
  <audio id="paint-sound" src="https://www.soundjay.com/buttons/sounds/button-16.mp3" preload="auto"></audio>

  <script>
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");
    const paintSound = document.getElementById("paint-sound");

    let currentTool = "bucket";
    let currentColor = "#000000";

    // 🎨 Paleta de cores geral
    const paletteColors = [
      "#F5E6CC", "#E0D8B0", "#B3C6A3", "#96A9A4", "#C2B9B0", "#D5C7BC", "#E8DCD3", "#F2EFE9", "#F8F5F1", "#FAF7F3",
      "#FDFDFD", "#FFFFFF", "#FFF9C4", "#FFDAB9", "#FFB7C5", "#F8BBD0", "#E1BEE7", "#DCEDC8", "#C8E6C9", "#B2DFDB",
      "#80CBC4", "#A7FFEB", "#E1F5FE", "#F48FB1", "#CE93D8", "#B39DDB", "#9FA8DA", "#B2EBF2", "#81D4FA", "#4FC3F7",
      "#29B6F6", "#B0BEC5"
    ];

    // 💡 Cores claras (tons suaves e neutros)
    const lightColors = [
      "#F5E6CC", "#E0D8B0", "#B3C6A3", "#96A9A4", "#C2B9B0", "#D5C7BC", "#E8DCD3", "#F2EFE9", "#F8F5F1", "#FAF7F3",
      "#FDFDFD", "#FFFFFF"
    ];

    // 🔥 Cores fortes e vivas (ideais para destaque, botões etc.)
    const strongColors = [
      "#FF3B30", "#FF9500", "#FFCC00", "#34C759", "#30B0C7", "#007AFF", "#5856D6", "#AF52DE",
      "#FF2D55", "#4CD964", "#FFD60A", "#FF375F"
    ];

    // Cores escuras (do geral, mas não claras)
    const darkColors = paletteColors.filter(color => !lightColors.includes(color));

    // Junta cores escuras + claras para o restante da paleta
    const allColors = darkColors.concat(lightColors);

    const paletteDiv = document.getElementById("palette");

    // Limpa paleta (caso execute várias vezes)
    paletteDiv.innerHTML = "";

    // Adiciona primeiro as cores fortes
    strongColors.forEach(color => {
      const c = document.createElement("div");
      c.className = "color";
      c.style.background = color;
      c.title = color; // ajuda visual ao passar mouse
      c.onclick = () => currentColor = color;
      paletteDiv.appendChild(c);
    });

    // Depois adiciona as demais cores (escuras + claras)
    allColors.forEach(color => {
      const c = document.createElement("div");
      c.className = "color";
      c.style.background = color;
      c.title = color;
      c.onclick = () => currentColor = color;
      paletteDiv.appendChild(c);
    });

    // 🖼️ Carregar imagem para pintar
    const image = new Image();
    image.src = "https://i.postimg.cc/yNv3xwzh/4.%IMAGE_EXT%";
    image.crossOrigin = "anonymous"; // evita bloqueio CORS
    image.onload = () => ctx.drawImage(image, 0, 0, canvas.width, canvas.height);

    // 🪣 Flood fill com som ao pintar
    canvas.addEventListener("click", e => {
      if (currentTool !== "bucket") return; // se precisar de outras ferramentas, trate aqui
      const rect = canvas.getBoundingClientRect();
      const x = Math.floor(e.clientX - rect.left);
      const y = Math.floor(e.clientY - rect.top);
      floodFill(x, y, hexToRgb(currentColor), 40);

      // 🔊 Tocar som
      paintSound.currentTime = 0;
      paintSound.play();
    });

    function floodFill(startX, startY, fillColor, tolerance) {
      const imgData = ctx.getImageData(0, 0, canvas.width, canvas.height);
      const data = imgData.data;
      const targetColor = getPixel(data, startX, startY);

      if (!targetColor) return;
      if (colorsMatch(targetColor, fillColor, tolerance)) return;

      const stack = [[startX, startY]];
      const width = canvas.width;
      const height = canvas.height;

      while (stack.length) {
        const [x, y] = stack.pop();
        if (x < 0 || x >= width || y < 0 || y >= height) continue;

        const currentColor = getPixel(data, x, y);
        if (!currentColor) continue;

        if (!colorsMatch(currentColor, targetColor, tolerance)) continue;

        setPixel(data, x, y, fillColor);

        stack.push([x + 1, y]);
        stack.push([x - 1, y]);
        stack.push([x, y + 1]);
        stack.push([x, y - 1]);
      }

      ctx.putImageData(imgData, 0, 0);
    }

    function getPixel(data, x, y) {
      if (x < 0 || x >= canvas.width || y < 0 || y >= canvas.height) return null;
      const i = (y * canvas.width + x) * 4;
      return [data[i], data[i + 1], data[i + 2]];
    }

    function setPixel(data, x, y, color) {
      const i = (y * canvas.width + x) * 4;
      data[i] = color[0];
      data[i + 1] = color[1];
      data[i + 2] = color[2];
      data[i + 3] = 255;
    }

    function colorsMatch(a, b, tolerance = 0) {
      return Math.abs(a[0] - b[0]) <= tolerance &&
        Math.abs(a[1] - b[1]) <= tolerance &&
        Math.abs(a[2] - b[2]) <= tolerance;
    }

    function hexToRgb(hex) {
      const bigint = parseInt(hex.slice(1), 16);
      return [(bigint >> 16) & 255, (bigint >> 8) & 255, bigint & 255];
    }

    // Funções extras
    function clearCanvas() {
      ctx.drawImage(image, 0, 0, canvas.width, canvas.height);
    }

    function saveImage() {
      const link = document.createElement('a');
      link.href = canvas.toDataURL("image/png");
      link.download = 'desenho.png';
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }

    function setTool(tool) {
      currentTool = tool;
    }
  </script>
</body>

</html>
